<?php

namespace EB\CoreBundle\Repository;

use Doctrine\ORM\EntityRepository;
use EB\CoreBundle\Entity\Admission;

/**
 * AdmissionRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class AdmissionRepository extends EntityRepository
{
    /**
     * @return mixed
     */
    public function countAll()
    {
        $qb = $this->createQueryBuilder('a');
        $qb->select('count(a.id)');

        return $qb->getQuery()->getSingleScalarResult();
    }

    /**
     * @param $status
     * @param $dayOffset
     * @return array
     */
    public function findByStatusAndClosedAtDayOffset($status, $dayOffset)
    {
        $now = new \DateTime();
        $now->sub(new \DateInterval("P{$dayOffset}D"));

        $qb = $this->createQueryBuilder('a');
        $qb->where('a.closedAt < :now')
            ->andWhere('a.status = :status')
            ->setParameter('status', $status)
            ->setParameter('now', $now)
        ;

        return $qb->getQuery()->getResult();
    }
}
